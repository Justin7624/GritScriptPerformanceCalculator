<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GritScript Performance – Peptide Calculator</title>


<style>
:root{
  --bg:#050607;
  --text:#e5e7eb;
  --muted:#9aa3ad;
  --border:#1c232c;
  --panel:#0b0f13;
  --field:#0f141a;
  --chip:#0b0f13;
  --chipActive:#101720;
  --accent:#c1121f;
  --shadow: 0 18px 40px rgba(0,0,0,.55);
  --radius: 14px;
  --warn:#ff6b6b;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--text);
  background: var(--bg);
  line-height:1.45;
  overflow-x:hidden;
}
img{max-width:100%;display:block}

/* Black cascading to red (consistent on PC + phone) */
body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:-2;
  background:
    linear-gradient(180deg,
      #040506 0%,
      #060709 38%,
      #060709 60%,
      rgba(80, 8, 14, 0.65) 100%
    );
}
/* Controlled glow layer */
body::after{
  content:"";
  position:fixed;
  inset:0;
  z-index:-1;
  background:
    radial-gradient(900px 600px at 12% 6%, rgba(229,231,235,.06), transparent 60%),
    radial-gradient(900px 700px at 85% 12%, rgba(193,18,31,.10), transparent 62%),
    radial-gradient(1100px 900px at 50% 110%, rgba(193,18,31,.16), transparent 62%);
  pointer-events:none;
}
@media (max-width: 640px){
  body::after{
    background:
      radial-gradient(800px 520px at 12% 6%, rgba(229,231,235,.05), transparent 62%),
      radial-gradient(800px 600px at 85% 12%, rgba(193,18,31,.07), transparent 64%),
      radial-gradient(900px 760px at 50% 112%, rgba(193,18,31,.10), transparent 66%);
  }
  body::before{
    background:
      linear-gradient(180deg,
        #040506 0%,
        #060709 50%,
        rgba(65, 6, 10, 0.55) 100%
      );
  }
}

/* Header (thin, full-width, NOT cropped) */
header.hero{
  width:100%;
  border-bottom:1px solid var(--border);
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
  position:sticky;
  top:0;
  z-index:20;
}
.hero-inner{ width:100%; padding:10px 0 12px; }
.hero-banner{
  width:100%;
  height:84px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  border-top:1px solid rgba(255,255,255,.06);
  border-bottom:1px solid rgba(255,255,255,.06);
}
.hero-banner img{
  height:100%;
  width:min(1400px, 100%);
  object-fit:contain;
  object-position:center;
  display:block;
  padding:6px 14px;
  filter: drop-shadow(var(--shadow));
}
@media (max-width: 640px){
  .hero-banner{ height:68px; }
  .hero-banner img{ padding:6px 10px; }
}

.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:8px 16px 0;
}
.title-row{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:12px;
  padding-bottom:10px;
}
.title-row h1{
  margin:0;
  font-size:22px;
  font-weight:950;
  letter-spacing:.2px;
}

.shell{
  max-width:1100px;
  margin:18px auto 90px;
  padding:0 18px;
  display:grid;
  grid-template-columns:minmax(0,1.1fr) minmax(0,.9fr);
  gap:16px;
  align-items:start
}
@media (max-width:900px){ .shell{ grid-template-columns:1fr } }

.panel{
  background:
    radial-gradient(900px 600px at 85% 30%, rgba(193,18,31,.10), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.015));
  border:1px solid rgba(193,18,31,.28);
  border-radius:18px;
  padding:16px;
  box-shadow:
    0 0 0 2px rgba(193,18,31,.10) inset,
    0 22px 60px rgba(0,0,0,.62);
  backdrop-filter: blur(6px);
}
.panel-head{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:flex-start;
  margin-bottom:12px
}
.panel-head h2{ margin:0; font-size:16px; font-weight:950 }
.sub{ font-size:12px; color:var(--muted); margin-top:2px }

.grid{ display:grid; grid-template-columns:repeat(12,minmax(0,1fr)); gap:10px 12px }
.field{ grid-column:span 6; display:flex; flex-direction:column; gap:6px }
.field.short{ grid-column:span 4 }
.field.wide{ grid-column:span 12 }
@media (max-width:900px){
  .field,.field.short,.field.wide{ grid-column:span 12 }
}

label{ font-size:12px; color:var(--muted) }

input,select{
  background: rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.12);
  border-radius:12px;
  color:var(--text);
  padding:10px 12px;
  font-size:14px;
  outline:none;
}
input::placeholder{ color: rgba(229,231,235,.55); }
input:focus,select:focus{
  border-color: rgba(193,18,31,.8);
  box-shadow: 0 0 0 3px rgba(193,18,31,.12);
}
.row{ display:grid; grid-template-columns:minmax(0,1fr) 96px; gap:8px; align-items:center }
.row select{ width:96px }

.chips{ display:flex; flex-wrap:wrap; gap:8px }

.chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid var(--border);
  background:var(--chip);
  color:var(--text);
  padding:9px 12px;
  border-radius:999px;
  cursor:pointer;
  font-weight:800;
  font-size:12px;
  transition: transform .06s ease, border-color .15s ease, background .15s ease;
}
.chip:hover{
  border-color: rgba(193,18,31,.65);
  background: rgba(193,18,31,.10);
}
.chip:active{ transform: translateY(1px); }
.chip.ghost{ background:transparent; color:var(--muted) }
.chip[aria-pressed="true"]{
  background:var(--chipActive);
  border-color: rgba(193,18,31,.8);
  box-shadow: 0 0 0 2px rgba(193,18,31,.12) inset;
  color:var(--text);
}

/* Result */
.headline{ font-size:16px; font-weight:950; letter-spacing:-.01em }
.headline .hl{ color: var(--accent) }
.meta{ margin-top:6px; color:var(--muted); font-size:12px }

.stats{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:14px }
.stat{
  background: rgba(0,0,0,.25);
  border:1px dashed rgba(193,18,31,.35);
  padding:10px;
  border-radius:12px;
  font-size:13px
}
.stat b{ display:block; font-size:12px; color: rgba(229,231,235,.75); margin-bottom:4px }

/* Classic syringe visual */
.classic{
  background: rgba(0,0,0,.28);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px;
  margin-top:12px
}
.tube{
  position:relative;
  height:28px;
  border-radius:16px;
  background: linear-gradient(180deg,#11131a,#0b0c10);
  border:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 2px 8px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05)
}
.fill{
  position:absolute; left:0; top:0; bottom:0; width:0%;
  background: linear-gradient(90deg, rgba(193,18,31,1), rgba(193,18,31,.65));
  border-radius:16px;
  box-shadow: inset 0 0 12px rgba(255,255,255,.18), 0 0 26px rgba(193,18,31,.30)
}
.cursor{
  position:absolute; top:-6px; width:2px;
  background: rgba(229,231,235,.75);
  height:40px; border-radius:2px;
  box-shadow: 0 0 0 2px rgba(193,18,31,.15)
}
.ticks{ position:relative; height:34px; margin-top:8px; margin-bottom:6px; padding:0 2px }
.tick{ position:absolute; bottom:14px; width:1px; background: rgba(229,231,235,.25); transform:translateX(-0.5px) }
.tick.minor{ height:8px; opacity:.55 }
.tick.mid{ height:12px; opacity:.8 }
.tick.major{ height:16px; opacity:1; background: rgba(229,231,235,.38) }
.tick .n{
  position:absolute; top:18px; left:50%;
  transform:translateX(-50%);
  font-size:11px;
  color: rgba(229,231,235,.65);
  white-space:nowrap
}

.warn{ margin-top:10px; color:var(--warn); font-weight:900; font-size:13px; display:none }
.note{ margin-top:10px; color:var(--muted); font-size:12px }

.footer{
  position:fixed; left:0; right:0; bottom:0;
  background: rgba(0,0,0,.55);
  border-top:1px solid rgba(255,255,255,.08);
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);
}
.foot-wrap{
  max-width:1100px;
  margin:auto;
  padding:10px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.small{ font-size:12px; color: rgba(229,231,235,.70) }

/* Hide number spinners (consistent) */
input[type="number"]{ appearance:textfield; -webkit-appearance:textfield; -moz-appearance:textfield }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
</style>
</head>

<body>
<header class="hero">
  <div class="hero-inner">
    <div class="hero-banner">
      <img src="header.png" alt="GritScript Performance" />
    </div>
    <div class="wrap">
      <div class="title-row">
        <h1>Peptide Calculator</h1>
      </div>
    </div>
  </div>
</header>

<main class="shell">
  <!-- LEFT -->
  <section class="panel" aria-label="Vial and dose settings">
    <div class="panel-head">
      <div>
        <h2>Vial & Dose Settings</h2>
        <div class="sub">Describe your vial, diluent, and the dose you want to pull.</div>
      </div>
      <button id="reset" class="chip ghost" type="button">Reset</button>
    </div>

    <div class="grid">
      <div class="field short">
        <label for="amountPerVial">Content per vial</label>
        <div class="row" style="grid-template-columns:minmax(0,1fr) 96px">
          <input id="amountPerVial" type="number" min="0" step="0.1" value="5" aria-label="Amount per vial">
          <select id="vialUnit" aria-label="Vial unit">
            <option value="mg" selected>mg</option>
            <option value="iu">IU</option>
          </select>
        </div>
      </div>

      <div class="field short">
        <label for="diluentMl">Total diluent added</label>
        <input id="diluentMl" type="number" min="0" step="0.1" value="1">
      </div>

      <div class="field short">
        <label for="syringeScale">Insulin syringe scale</label>
        <select id="syringeScale">
          <option value="30">30 units</option>
          <option value="50">50 units</option>
          <option value="100" selected>100 units</option>
        </select>
      </div>

      <div class="field wide">
        <label for="desiredDose">Desired dose</label>
        <div class="row">
          <input id="desiredDose" type="number" min="0" step="0.01" value="0.5" class="desired-input">
          <select id="desiredUnit" data-role="unit" aria-label="Desired dose unit">
            <option value="mg" selected>mg</option>
            <option value="mcg">mcg</option>
            <option value="iu">IU</option>
          </select>
        </div>
        <div class="note" id="presetWrap">
          <div class="small" style="margin-bottom:6px">Quick presets (mg / mcg only)</div>
          <div class="chips" id="presetMg">
            <button class="chip" type="button" data-dose="1" data-unit="mg">1 mg</button>
            <button class="chip" type="button" data-dose="2" data-unit="mg">2 mg</button>
            <button class="chip" type="button" data-dose="5" data-unit="mg">5 mg</button>
            <button class="chip" type="button" data-dose="10" data-unit="mg">10 mg</button>
          </div>
          <div class="chips" id="presetMcg" style="display:none">
            <button class="chip" type="button" data-dose="100" data-unit="mcg">100 mcg</button>
            <button class="chip" type="button" data-dose="250" data-unit="mcg">250 mcg</button>
            <button class="chip" type="button" data-dose="500" data-unit="mcg">500 mcg</button>
            <button class="chip" type="button" data-dose="1000" data-unit="mcg">1000 mcg</button>
          </div>
        </div>

        <p class="note">
          Assumes a U-100 insulin syringe where <b>1 unit = 0.01 mL</b>. Values update as you type.
        </p>
      </div>
    </div>
  </section>

  <!-- RIGHT -->
  <section class="panel" aria-label="Dose result and visual guide">
    <div class="panel-head">
      <div>
        <h2>Pull this amount</h2>
        <div class="sub">How many units to draw for the dose you specified.</div>
      </div>
    </div>

    <div class="headline">
      For a dose of <span class="hl" id="doseSummary">—</span>, draw to <span class="hl" id="unitsOut">—</span> units.
    </div>
    <div class="meta" id="mlOut">—</div>

    <div class="stats">
      <div class="stat">
        <b>Units to pull</b>
        <span id="unitsChip">—</span>
      </div>
      <div class="stat">
        <b>Per syringe unit</b>
        <span><span id="perUnitVal">—</span> <span id="perUnitUnit">—</span></span>
        <div class="small" id="altPerUnit" style="margin-top:4px;display:none">≈ <span id="altPerUnitVal">—</span> mcg per unit</div>
      </div>
    </div>

    <div class="classic" aria-live="polite">
      <div class="tube">
        <div class="fill" id="fill"></div>
        <div class="cursor" id="cursor" aria-hidden="true"></div>
      </div>
      <div class="ticks" id="ticks" aria-hidden="true"></div>
      <div class="warn" id="warn"></div>
    </div>

    <div class="note">
      Visual helper only — not a medical device.
    </div>
  </section>
</main>

<footer class="footer">
  <div class="foot-wrap">
    <div class="small">Research use only. Not medical advice.</div>
    <div class="small">Always verify your label and concentration.</div>
  </div>
</footer>

<script>
/* ---------- Classic math with unit handling (mirrors catalog mini-calculator logic) ---------- */
function classicCalc({amountPerVial, vialUnit='mg', diluentMl, desired, desiredUnit='mg', syringeScale=100}) {
  const amt   = Number(amountPerVial)||0;
  const mlD   = Number(diluentMl)||0;
  const want  = Number(desired)||0;
  const scale = Number(syringeScale)||100;

  const vUnit = String(vialUnit||'mg').toLowerCase();
  const dUnit = String(desiredUnit||'mg').toLowerCase();

  let desiredInVial = NaN;
  let note = '';

  if (vUnit === 'mg') {
    if (dUnit === 'mg') desiredInVial = want;
    else if (dUnit === 'mcg') desiredInVial = want/1000;
    else if (dUnit === 'iu') note = 'Unit mismatch: this vial is in mg, but desired dose is in IU. mg ↔ IU conversion is not possible without a product-specific factor.';
    else note = 'Unsupported desired dose unit.';
  } else if (vUnit === 'iu') {
    if (dUnit === 'iu') desiredInVial = want;
    else if (dUnit === 'mg' || dUnit === 'mcg') note = 'Unit mismatch: this vial is in IU, but desired dose is in mg/mcg. mg ↔ IU conversion is not possible without a product-specific factor.';
    else note = 'Unsupported desired dose unit.';
  } else {
    note = 'Unsupported vial unit.';
  }

  // concentration in "vial units" (mg or IU) per mL
  const perMl = (amt>0 && mlD>0) ? (amt/mlD) : NaN;

  // insulin syringe assumption: 1 unit = 0.01 mL
  const vialUnitsPerUnit = isFinite(perMl) ? (perMl * 0.01) : NaN;

  // syringe units to pull
  const syringeUnits = (isFinite(vialUnitsPerUnit) && isFinite(desiredInVial) && desiredInVial>=0)
    ? (desiredInVial / vialUnitsPerUnit)
    : NaN;

  const pct = (isFinite(syringeUnits) && scale>0)
    ? Math.max(0, Math.min(100, (syringeUnits/scale)*100))
    : 0;

  return { vialUnit:vUnit, desiredUnit:dUnit, vialUnitsPerUnit, units:syringeUnits, unitsPct:pct, syringeScale:scale, note };
}

/* ---------- UI wiring ---------- */
document.addEventListener('DOMContentLoaded', () => {
  const $ = (id) => document.getElementById(id);

  const el = {
    amountPerVial: $('amountPerVial'),
    vialUnit: $('vialUnit'),
    diluentMl: $('diluentMl'),
    syringeScale: $('syringeScale'),
    desiredDose: $('desiredDose'),
    desiredUnit: $('desiredUnit'),
    reset: $('reset'),

    doseSummary: $('doseSummary'),
    unitsOut: $('unitsOut'),
    mlOut: $('mlOut'),
    unitsChip: $('unitsChip'),
    perUnitVal: $('perUnitVal'),
    perUnitUnit: $('perUnitUnit'),
    altPerUnit: $('altPerUnit'),
    altPerUnitVal: $('altPerUnitVal'),

    fill: $('fill'),
    cursor: $('cursor'),
    ticks: $('ticks'),
    warn: $('warn'),

    presetWrap: $('presetWrap'),
    presetMg: $('presetMg'),
    presetMcg: $('presetMcg')
  };

  function buildTicks(maxUnits){
    // Proper insulin-syringe style ticks:
    // U-100 + U-50: major every 10, mid at 5, minor every 1
    // U-30: major every 5 (labeled), minor every 1
    const max = Math.max(1, Number(maxUnits)||100);

    const majorEvery = (max === 30) ? 5 : 10;
    const hasMid = (majorEvery === 10);
    const midEvery = 5;

    el.ticks.innerHTML = '';
    for (let n = 0; n <= max; n++){
      const div = document.createElement('div');

      let cls = 'minor';
      if (n % majorEvery === 0) cls = 'major';
      else if (hasMid && (n % midEvery === 0)) cls = 'mid';

      div.className = `tick ${cls}`;
      div.style.left = `${(n / max) * 100}%`;

      // Labels on major ticks
      if (n % majorEvery === 0){
        const lab = document.createElement('div');
        lab.className = 'n';
        lab.textContent = n;
        div.appendChild(lab);
      }

      el.ticks.appendChild(div);
    }
  }

  function setWarn(msg){
    if (msg && String(msg).trim()){
      el.warn.textContent = `⚠️ ${msg}`;
      el.warn.style.display = 'block';
    } else {
      el.warn.textContent = '';
      el.warn.style.display = 'none';
    }
  }

  function updatePresetVisibility(){
    const u = String(el.desiredUnit.value||'mg').toLowerCase();
    const show = (u === 'mg' || u === 'mcg');
    el.presetWrap.style.display = show ? 'block' : 'none';
    el.presetMg.style.display = (u === 'mg') ? 'flex' : 'none';
    el.presetMcg.style.display = (u === 'mcg') ? 'flex' : 'none';
  }

  function clearPresetPressed(){
    document.querySelectorAll('[data-dose][data-unit]').forEach(b=>b.setAttribute('aria-pressed','false'));
  }

  function wirePresets(container){
    container.querySelectorAll('button[data-dose]').forEach(btn=>{
      btn.setAttribute('aria-pressed','false');
      btn.addEventListener('click', ()=>{
        clearPresetPressed();
        btn.setAttribute('aria-pressed','true');
        el.desiredUnit.value = btn.dataset.unit;
        el.desiredDose.value = btn.dataset.dose;
        updatePresetVisibility();
        recalc();
      });
    });
  }

  function convertDoseValue(prevUnit, nextUnit){
    const v = Number(el.desiredDose.value);
    if (!isFinite(v) || prevUnit === nextUnit) return;

    // Only convert between mg and mcg automatically (mirrors prior behavior).
    if (prevUnit === 'mcg' && nextUnit === 'mg') el.desiredDose.value = (v/1000);
    else if (prevUnit === 'mg' && nextUnit === 'mcg') el.desiredDose.value = (v*1000);
  }

  function recalc(){
    const res = classicCalc({
      amountPerVial: el.amountPerVial.value,
      vialUnit: el.vialUnit.value,
      diluentMl: el.diluentMl.value,
      desired: el.desiredDose.value,
      desiredUnit: el.desiredUnit.value,
      syringeScale: el.syringeScale.value
    });

    const want = Number(el.desiredDose.value);
    const dUnit = String(el.desiredUnit.value||'mg').toLowerCase();
    const dUnitLabel = (dUnit==='iu') ? 'IU' : dUnit;

    el.doseSummary.textContent = (isFinite(want) ? want : 0) + ' ' + dUnitLabel;

    el.unitsOut.textContent = isFinite(res.units) ? res.units.toFixed(2) : '—';
    el.unitsChip.textContent = isFinite(res.units) ? res.units.toFixed(2) + ' units' : '—';

    const ml = isFinite(res.units) ? (res.units * 0.01) : NaN;
    el.mlOut.textContent = isFinite(ml) ? `≈ ${ml.toFixed(3)} mL (units × 0.01 mL)` : '—';

    el.perUnitVal.textContent = isFinite(res.vialUnitsPerUnit) ? res.vialUnitsPerUnit.toFixed(4) : '—';
    el.perUnitUnit.textContent = (res.vialUnit === 'iu') ? 'IU / unit' : 'mg / unit';

    // alt mcg per unit only if vial is mg
    if (res.vialUnit === 'mg' && isFinite(res.vialUnitsPerUnit)){
      el.altPerUnit.style.display = 'block';
      el.altPerUnitVal.textContent = (res.vialUnitsPerUnit * 1000).toFixed(2);
    } else {
      el.altPerUnit.style.display = 'none';
      el.altPerUnitVal.textContent = '—';
    }

    // Visual
    const pct = Number(res.unitsPct)||0;
    el.fill.style.width = pct + '%';
    el.cursor.style.left = `calc(${pct}% - 1px)`;

    // Warnings: unit mismatch and/or syringe overflow
    const warns = [];
    if (res.note) warns.push(res.note);
    if (isFinite(res.units) && res.units > Number(res.syringeScale||0)) {
      warns.push(`Dose exceeds the selected syringe scale of ${res.syringeScale} units. Consider more diluent, a larger syringe, or a smaller dose.`);
    }
    setWarn(warns.join(' '));
  }

  function reset(){
    el.amountPerVial.value = '5';
    el.vialUnit.value = 'mg';
    el.diluentMl.value = '1';
    el.syringeScale.value = '100';
    el.desiredDose.value = '0.5';
    el.desiredUnit.value = 'mg';
    clearPresetPressed();
    updatePresetVisibility();
    buildTicks(el.syringeScale.value);
    recalc();
  }

  // Wire events
  ['input','change','keyup'].forEach(evt=>{
    [el.amountPerVial, el.vialUnit, el.diluentMl, el.syringeScale, el.desiredDose, el.desiredUnit].forEach(node=>{
      node.addEventListener(evt, ()=>{
        if (node === el.syringeScale) buildTicks(el.syringeScale.value);
        if (node === el.vialUnit) {
          // If vial is IU, default desired unit to IU (like catalog mini-calculator)
          if (String(el.vialUnit.value).toLowerCase() === 'iu' && String(el.desiredUnit.value).toLowerCase() !== 'iu') {
            el.desiredUnit.value = 'iu';
            clearPresetPressed();
            updatePresetVisibility();
          }
        }
        recalc();
      });
    });
  });

  let lastDesiredUnit = el.desiredUnit.value;
  el.desiredUnit.addEventListener('change', ()=>{
    convertDoseValue(lastDesiredUnit, el.desiredUnit.value);
    lastDesiredUnit = el.desiredUnit.value;
    clearPresetPressed();
    updatePresetVisibility();
    recalc();
  });

  el.reset.addEventListener('click', reset);

  wirePresets(el.presetMg);
  wirePresets(el.presetMcg);

  updatePresetVisibility();
  buildTicks(el.syringeScale.value);
  recalc();
});
</script>
</body>
</html>
